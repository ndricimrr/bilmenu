name: Gemini HTML Processor

on:
  # schedule:
  #   - cron: '0 * * * *'
  # workflow_dispatch:
  pull_request:

jobs:
  process:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v3

      - name: Install dependencies
        run: npm install

      - name: Clean HTML
        run: node webapp/cleanHtmlScript.js > cleaned.txt

      - name: Call Gemini API with cleaned HTML
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          CLEANED_HTML=$(cat cleaned.txt | jq -Rs .)
          PROMPT='You will receive HTML content. Cleanly extract structured data into JSON format only, like:
          {
            "title": "...",
            "sections": [{ "heading": "...", "content": "..." }]
          } No explanation or markdown. Only return JSON.'
          echo "CLEANED_HTML: $CLEANED_HTML" | jq -R . > cleaned.json

      - name: Show Result
        run: cat output.json

        # https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}

        # curl "https://jsonplaceholder.typicode.com/todos/1" \
        #     -H 'Content-Type: application/json' \
        #     -X GET \
        #     -d '{
        #       "contents": [
        #         {
        #           "parts": [
        #             {
        #               "text": "'"$PROMPT\n\nHere is the HTML:\n"'$CLEANED_HTML'"
        #             }
        #           ]
        #         }
        #       ]
        #     }' | jq '.candidates[0].content.parts[0].text' > output.json
